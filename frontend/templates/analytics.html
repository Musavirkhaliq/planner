<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Analytics | Productivity Planner</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <main class="container mt-5">
    <h2 class="mb-4">Analytics</h2>

    <div class="row mb-4">
      <div class="col-md-3">
        <label for="startDate">Start Date:</label>
        <input type="date" id="startDate" class="form-control">
      </div>
      <div class="col-md-3">
        <label for="endDate">End Date:</label>
        <input type="date" id="endDate" class="form-control">
      </div>
      <div class="col-md-3">
        <label>&nbsp;</label>
        <button class="btn btn-primary w-100" onclick="fetchAnalytics()">Get Analytics</button>
      </div>
    </div>

    <canvas id="customAnalyticsChart"></canvas>
  </main>

  <script>
    function fetchAnalytics() {
        const startDate = document.getElementById("startDate").value;
        const endDate = document.getElementById("endDate").value;

        if (!startDate || !endDate) {
            alert("Please select a date range.");
            return;
        }

        fetch(`/analytics?start=${startDate}&end=${endDate}`)
            .then(response => response.json())
            .then(data => updateCustomAnalyticsChart(data))
            .catch(error => console.error("Error fetching analytics:", error));
    }

    function updateCustomAnalyticsChart(data) {
        const ctx = document.getElementById("customAnalyticsChart").getContext("2d");
        new Chart(ctx, {
            type: "line",
            data: {
                labels: data.labels,
                datasets: [{
                    label: "Minutes Focused",
                    data: data.minutes,
                    backgroundColor: "rgba(255, 99, 132, 0.6)",
                    borderColor: "rgba(255, 99, 132, 1)",
                    borderWidth: 1,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    }
  </script>
</body>
</html>
